<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twisty Game - Debug Loading</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #222;
            color: white;
            font-family: monospace;
        }
        .test {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #444;
            border-radius: 5px;
        }
        .success { background: rgba(0, 255, 0, 0.1); border-color: green; }
        .error { background: rgba(255, 0, 0, 0.1); border-color: red; }
        .warning { background: rgba(255, 255, 0, 0.1); border-color: yellow; }
        pre { background: #000; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>Twisty Game Debug - Loading Diagnostics</h1>
    <div id="results"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
    <script>
        const results = document.getElementById('results');
        
        function addTest(title, success, message, details) {
            const div = document.createElement('div');
            div.className = 'test ' + (success ? 'success' : 'error');
            div.innerHTML = `
                <h3>${success ? '✅' : '❌'} ${title}</h3>
                <p>${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            results.appendChild(div);
        }
        
        // Test 1: THREE.js loaded
        if (typeof THREE === 'undefined') {
            addTest('THREE.js Loading', false, 'THREE.js library not loaded');
        } else {
            addTest('THREE.js Loading', true, `THREE.js version r${THREE.REVISION} loaded successfully`);
        }
        
        // Test 2: WebGL support
        try {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                addTest('WebGL Support', true, 'WebGL is available');
            } else {
                addTest('WebGL Support', false, 'WebGL is not available');
            }
        } catch (e) {
            addTest('WebGL Support', false, 'WebGL check failed: ' + e.message);
        }
        
        // Test 3: CanvasTexture
        try {
            const canvas = document.createElement('canvas');
            canvas.width = 64;
            canvas.height = 64;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(0, 0, 64, 64);
            
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            addTest('CanvasTexture', true, 'CanvasTexture created successfully');
        } catch (e) {
            addTest('CanvasTexture', false, 'CanvasTexture failed: ' + e.message, e.stack);
        }
        
        // Test 4: PMREMGenerator
        try {
            const canvas = document.createElement('canvas');
            canvas.width = 512;
            canvas.height = 512;
            const renderer = new THREE.WebGLRenderer({ canvas });
            
            const pmremGenerator = new THREE.PMREMGenerator(renderer);
            pmremGenerator.compileEquirectangularShader();
            
            const envScene = new THREE.Scene();
            envScene.background = new THREE.Color(0xb8d4e8);
            const envMap = pmremGenerator.fromScene(envScene);
            pmremGenerator.dispose();
            
            addTest('PMREMGenerator', true, 'Environment map generation works');
        } catch (e) {
            addTest('PMREMGenerator', false, 'PMREMGenerator failed: ' + e.message, e.stack);
        }
        
        // Test 5: Basic Scene Creation
        try {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
            const canvas = document.createElement('canvas');
            const renderer = new THREE.WebGLRenderer({ canvas });
            
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            const cube = new THREE.Mesh(geometry, material);
            scene.add(cube);
            
            renderer.render(scene, camera);
            
            addTest('Basic Scene', true, 'Scene creation and rendering works');
        } catch (e) {
            addTest('Basic Scene', false, 'Scene creation failed: ' + e.message, e.stack);
        }
        
        // Test 6: Check all required classes
        const requiredClasses = [
            'Scene', 'PerspectiveCamera', 'WebGLRenderer', 'BoxGeometry',
            'MeshStandardMaterial', 'Mesh', 'AmbientLight', 'DirectionalLight',
            'Vector3', 'Euler', 'Color', 'FogExp2', 'CanvasTexture'
        ];
        
        let allClassesPresent = true;
        const missingClasses = [];
        
        requiredClasses.forEach(className => {
            if (typeof THREE[className] === 'undefined') {
                allClassesPresent = false;
                missingClasses.push(className);
            }
        });
        
        if (allClassesPresent) {
            addTest('Required Classes', true, 'All required THREE.js classes are available');
        } else {
            addTest('Required Classes', false, 
                'Missing classes: ' + missingClasses.join(', '));
        }
        
        // Test 7: Browser info
        const info = `
Browser: ${navigator.userAgent}
Platform: ${navigator.platform}
Screen: ${window.screen.width}x${window.screen.height}
Pixel Ratio: ${window.devicePixelRatio}
Online: ${navigator.onLine}
        `.trim();
        
        addTest('Browser Info', true, 'System information', info);
        
        // Add link to main game
        const link = document.createElement('div');
        link.className = 'test';
        link.style.textAlign = 'center';
        link.innerHTML = '<a href="index.html" style="color: #00ff00; font-size: 18px;">← Back to Game</a>';
        results.appendChild(link);
    </script>
</body>
</html>